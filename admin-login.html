<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¦</text></svg>">
  <title>InvManage - Admin Login</title>
</head>
<body>

<div id="authContainer" class="center-box">
  <!-- Simple Logo Section -->
  <div class="logo-container">
    <img src="image.png" alt="Logo" class="logo">
  </div>

  <!-- Simple Header -->
  <div class="header-content">
    <h2 class="main-title">
      <span class="title-gradient">InvManage</span>
      <span class="title-accent">Admin</span>
    </h2>
    <p class="subtitle">
      Administrator Access Portal
    </p>
  </div>

  <!-- Simple Tabs -->
  <div class="tabs">
    <button class="tab active" id="tabLogin">
      <span class="tab-text">Admin Login</span>
    </button>
    <button class="tab inactive" id="tabRegister">
      <span class="tab-text">Admin Register</span>
    </button>
  </div>

  <!-- Admin Login Form -->
  <form id="loginForm" class="form-container" onsubmit="return false;">
    <div class="form-header">
      <h3>Administrator Login</h3>
      <p>Access admin panel for system management</p>
    </div>

    <div class="input-group">
      <label>Admin Username</label>
      <input type="text" id="adminLoginUsername" placeholder="Enter admin username">
      <div class="input-underline"></div>
    </div>

    <div class="input-group">
      <label>Password</label>
      <input type="password" id="adminLoginPassword" placeholder="Enter admin password">
      <div class="input-underline"></div>
    </div>

    <div class="form-options">
      <label class="remember-me">
        <input type="checkbox" id="rememberMe">
        <span class="checkmark"></span>
        Remember my login
      </label>
      <a href="#" class="forgot-password">Forgot password?</a>
    </div>

    <button type="button" class="primary" onclick="doAdminLogin()">
      <span class="btn-content">
        <span class="btn-text">Login Admin</span>
      </span>
    </button>

    <div class="form-footer">
      <p>Need user access? <a href="index.html?direct=login">User Login</a></p>
    </div>
  </form>

  <!-- Admin Register Form -->
  <div id="registerForm" class="form-container" style="display:none;">
    <div class="form-header">
      <h3>Register Administrator</h3>
      <p>Create admin account for system management</p>
    </div>

    <div class="input-group">
      <label>Admin Name</label>
      <input type="text" id="registerUsername" placeholder="Enter admin name">
      <div class="input-underline"></div>
    </div>

    <div class="input-group">
      <label>Password</label>
      <input type="password" id="registerPassword" placeholder="Create admin password">
      <div class="input-underline"></div>
    </div>

    <div class="input-group">
      <label>Admin Code</label>
      <input type="text" id="registerAdminCode" placeholder="Enter admin code">
      <div class="input-underline"></div>
    </div>

    <div class="terms-agreement">
      <label class="checkbox-container">
        <input type="checkbox" id="agreeTerms" required>
        <span class="checkmark"></span>
        I agree to the <a href="admin-terms.html" target="_blank" class="terms-link">Terms & Conditions</a> for administrators
      </label>
    </div>

    <button class="primary" onclick="doAdminRegister()">
      <span class="btn-content">
        <span class="btn-text">Create Admin Account</span>
      </span>
    </button>

    <div class="form-footer">
      <p>Already have an account? <a href="#" onclick="switchToLogin()">Login here</a></p>
    </div>
  </div>
</div>


<script>
  // Admin-specific login function
  async function doAdminLogin() {
    const nama = document.getElementById("adminLoginUsername")?.value?.trim();
    const password = document.getElementById("adminLoginPassword")?.value;
    const loginBtn = document.getElementById("loginForm")?.querySelector("button.primary");

    if (!nama || !password) {
      showNotification("Nama dan password admin wajib diisi", "warning");
      return;
    }

    // Show loading state
    if (loginBtn) {
      loginBtn.disabled = true;
      loginBtn.innerHTML = `
        <span style="display: inline-flex; align-items: center; gap: 8px;">
          <div style="width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: enterpriseSpin 1s linear infinite;"></div>
          Logging in...
        </span>
      `;
    }

    try {
      const res = await fetch(`${API_BASE}/admin/login/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nama, password }),
      });

      if (!res.ok) {
        if (loginBtn) {
          loginBtn.disabled = false;
          loginBtn.innerHTML = `
            <span class="btn-content">
              <span class="btn-text">Login Admin</span>
            </span>
          `;
        }

        if (res.status === 400) {
          const errorData = await res.json();
          showNotification(errorData.error || "Username atau password salah", "error");
          return;
        } else if (res.status >= 500) {
          showNotification("Server mengalami masalah. Coba lagi nanti.", "error");
          return;
        } else {
          showNotification("Gagal terhubung ke server", "error");
          return;
        }
      }

      const data = await res.json();

      if (data.success) {
        // Check if user has admin role
        if (data.user.role !== 'admin') {
          showNotification("Akun ini bukan akun administrator. Silakan gunakan halaman login user.", "error");
          return;
        }

        // Set user access level based on login page (admin dashboard access)
        const userWithAccess = { ...data.user, accessLevel: 'admin' };
        setCurrentUser(userWithAccess);
        showNotification("Login berhasil! Mengalihkan ke Dashboard...", "success");

        // Smooth transition before redirect
        setTimeout(() => {
          window.location.href = "dashboard.html";
        }, 1000);
      } else {
        if (loginBtn) {
          loginBtn.disabled = false;
          loginBtn.innerHTML = `
            <span class="btn-content">
              <span class="btn-text">Login Admin</span>
            </span>
          `;
        }
        showNotification(data.error || "Login gagal", "error");
      }
    } catch (err) {
      if (loginBtn) {
        loginBtn.disabled = false;
        loginBtn.innerHTML = `
          <span class="btn-content">
            <span class="btn-text">Login Admin</span>
          </span>
        `;
      }
      console.error('Admin Login Error:', err);
      showNotification("Gagal terhubung ke server", "error");
    }
  }

  // Admin-specific register function
  async function doAdminRegister() {
    const nama = document.getElementById("registerUsername")?.value?.trim();
    const password = document.getElementById("registerPassword")?.value;
    const adminCode = document.getElementById("registerAdminCode")?.value?.trim();
    const registerBtn = document.getElementById("registerForm")?.querySelector("button.primary");

    if (!nama || !password || !adminCode) {
      showNotification("Nama, password, dan kode admin wajib diisi", "warning");
      return;
    }

    if (adminCode !== 'ADMIN2025') {
      showNotification("Kode admin salah!", "warning");
      return;
    }

    // Show loading state
    if (registerBtn) {
      registerBtn.disabled = true;
      registerBtn.innerHTML = `
        <span style="display: inline-flex; align-items: center; gap: 8px;">
          <div style="width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: enterpriseSpin 1s linear infinite;"></div>
          Mendaftarkan...
        </span>
      `;
    }

    try {
      const res = await fetch(`${API_BASE}/admin/register/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nama, password, admin_code: adminCode }),
      });

      if (!res.ok) {
        if (registerBtn) {
          registerBtn.disabled = false;
          registerBtn.innerHTML = `
            <span class="btn-content">
              <span class="btn-icon">ðŸŽ¯</span>
              <span class="btn-text">Buat Akun Admin</span>
            </span>
          `;
        }

        if (res.status === 400) {
          const errorData = await res.json();
          showNotification(errorData.error || "Data registrasi admin tidak valid", "error");
          return;
        } else if (res.status >= 500) {
          showNotification("Server mengalami masalah. Coba lagi nanti.", "error");
          return;
        } else {
          showNotification("Gagal terhubung ke server", "error");
          return;
        }
      }

      const data = await res.json();

      if (data.success) {
        if (registerBtn) {
          registerBtn.disabled = false;
          registerBtn.innerHTML = `
            <span class="btn-content">
              <span class="btn-icon">ðŸŽ¯</span>
              <span class="btn-text">Buat Akun Admin</span>
            </span>
          `;
        }
        showNotification("Registrasi admin berhasil! Mengalihkan ke login...", "success");

        // Smooth transition to login tab
        setTimeout(() => {
          if (document.getElementById("tabLogin")) document.getElementById("tabLogin").click();
        }, 1500);
      } else {
        if (registerBtn) {
          registerBtn.disabled = false;
          registerBtn.innerHTML = `
            <span class="btn-content">
              <span class="btn-icon">ðŸŽ¯</span>
              <span class="btn-text">Buat Akun Admin</span>
            </span>
          `;
        }
        showNotification(data.error || "Registrasi admin gagal", "error");
      }
    } catch (err) {
      if (registerBtn) {
        registerBtn.disabled = false;
        registerBtn.innerHTML = `
          <span class="btn-content">
            <span class="btn-icon">ðŸŽ¯</span>
            <span class="btn-text">Buat Akun Admin</span>
          </span>
        `;
      }
      console.error('Admin Register Error:', err);
      showNotification("Gagal terhubung ke server admin", "error");
    }
  }

  // Navigate to user login
  function goToUserLogin() {
    window.location.href = "index.html?direct=login";
  }

  // Simple Tab Switching
  const loginTab = document.getElementById("tabLogin");
  const registerTab = document.getElementById("tabRegister");
  const loginForm = document.getElementById("loginForm");
  const registerForm = document.getElementById("registerForm");

  function switchToLogin() {
    loginTab.classList.add("active");
    loginTab.classList.remove("inactive");
    registerTab.classList.remove("active");
    registerTab.classList.add("inactive");

    loginForm.style.display = "block";
    registerForm.style.display = "none";
  }

  function switchToRegister() {
    registerTab.classList.add("active");
    registerTab.classList.remove("inactive");
    loginTab.classList.remove("active");
    loginTab.classList.add("inactive");

    loginForm.style.display = "none";
    registerForm.style.display = "block";
  }

  loginTab.onclick = switchToLogin;
  registerTab.onclick = switchToRegister;

  // Enter key support
  document.getElementById("adminLoginPassword")?.addEventListener("keypress", (e) => {
    if (e.key === "Enter") doAdminLogin();
  });
  document.getElementById("registerPassword")?.addEventListener("keypress", (e) => {
    if (e.key === "Enter") doAdminRegister();
  });

  // Terms agreement validation
  document.getElementById("agreeTerms")?.addEventListener("change", (e) => {
    const registerBtn = document.querySelector("#registerForm .primary");
    if (registerBtn) {
      registerBtn.disabled = !e.target.checked;
      registerBtn.style.opacity = e.target.checked ? "1" : "0.6";
    }
  });

  // Remember me functionality
  document.getElementById("rememberMe")?.addEventListener("change", (e) => {
    if (e.target.checked) {
      showNotification("Remember me feature will save your login", "success", 3000);
    }
  });

  // Initialize form states
  document.addEventListener("DOMContentLoaded", () => {
    // Set initial display
    loginForm.style.display = "block";
    registerForm.style.display = "none";
  });

</script>

<script src="app.js?v=20251226"></script>

<!-- Copyright Footer -->
<footer class="copyright-footer">
  <p>&copy; 2025 InvManage. All rights reserved.</p>
  <div class="copyright-team">
    <div class="team-member">
      <div class="team-role">Software Architect & Developer</div>
      <div class="team-name">
        <a href="https://pddikti.kemdiktisaintek.go.id/detail-mahasiswa/eDuxj6_KTmf6YPT4mS22ImxLcI2AMpeH-UDBV4sZj3dkDlM-mOCRH1tohrHDnMuLchCNVg==" target="_blank">
          Alifito Rabbani Cahyono
        </a>
      </div>
    </div>
    <div class="team-member">
      <div class="team-role">UI/UX Architect & Developer</div>
      <div class="team-name">
        <a href="https://pddikti.kemdiktisaintek.go.id/detail-mahasiswa/NOLSmx8LbYciDdNeAiC78KLe0D79FgZs3AQQ-Rp0U9MwtQK3A48MEeHOf-_ZwbtJOMFwxw==" target="_blank">
          Satria Febry Andanu
        </a>
      </div>
    </div>
    <div class="team-member">
      <div class="team-role">Data Analyst & Engineer</div>
      <div class="team-name">
        <a href="https://pddikti.kemdiktisaintek.go.id/detail-mahasiswa/mhbV5ChTDJtuFBK7x0DFSQMCI7JObDTv_hYV9KHaAA3_Xioi_j3PO2C4_oiCFjQwte-7Ig==" target="_blank">
          Naufal Thafhan
        </a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>